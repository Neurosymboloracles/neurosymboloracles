import os
import requests
import json

# Remplace par ton vrai JWT de Pinata (dashboard > API Keys)
PINATA_JWT = "eyJhbGci..........................."  # TON JWT ICI !

HEADERS = {"Authorization": f"Bearer {PINATA_JWT}"}
UPLOAD_URL = "https://uploads.pinata.cloud/v3/files"

def upload_file(filepath, name=None):
    with open(filepath, "rb") as file_data:
        files = {"file": (os.path.basename(filepath) if name is None else name, file_data)}
        response = requests.post(UPLOAD_URL, headers=HEADERS, files=files)
    if response.status_code == 200:
        return response.json()["data"]["cid"]
    else:
        print(f"Erreur pour {filepath}: {response.text}")
        return None

# Upload tous JSON et PNG
cids = {"json": {}, "png": {}}
for folder, cid_dict in [("metadata", cids["json"]), ("images", cids["png"])]:
    for filename in os.listdir(folder):
        filepath = os.path.join(folder, filename)
        cid = upload_file(filepath)
        if cid:
            cid_dict[filename] = cid
            print(f"{filename} uploadé ! CID: {cid}")

# Sauvegarde tous les CIDs dans un fichier
with open("all_cids.json", "w") as f:
    json.dump(cids, f, indent=2)

print("Upload terminé ! Vérifie sur gateway.pinata.cloud/ipfs/<CID>")
